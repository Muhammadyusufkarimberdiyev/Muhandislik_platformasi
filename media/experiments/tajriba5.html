<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Charging Indicator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        /* HEADER */
        .header {
            display: flex;
            align-items: center;
            background: #000075;
            color: white;
            padding: 10px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* MAIN LAYOUT */
        .main-container {
            display: flex;
            margin-top: 20px;
            gap: 20px;
        }

        /* LEFT PANEL */
        .left-panel {
            width: 250px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            height: fit-content;
            position: fixed;
            left: 20px;
            top: 100px;
            z-index: 1000;
        }

        .control-group {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-bottom: 8px;
            font-size: 14px;
            border-radius: 8px;
            transition: all 0.3s;
            text-align: left;
            font-weight: 500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-success { 
            background: linear-gradient(45deg, #28a745, #20c997); 
            color: white; 
        }
        .btn-danger { 
            background: linear-gradient(45deg, #dc3545, #fd7e14); 
            color: white; 
        }
        .btn-primary { 
            background: linear-gradient(45deg, #000075, #4169e1); 
            color: white; 
        }
        .btn-info { 
            background: linear-gradient(45deg, #17a2b8, #6f42c1); 
            color: white; 
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            font-size: 13px;
        }

        .status-led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            transition: all 0.3s ease;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .status-led.on {
            background: #28a745;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.8);
        }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            margin-left: 290px;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .title-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 40px;
            text-align: center;
            display: inline-block;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* CIRCUIT CONTAINER */
        .circuit-container {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }

        /* CIRCUIT BOARD */
        .circuit-board {
            background: #e8f4fd;
            border: 4px solid #000075;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            height: 500px;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 117, 255, 0.3);
        }

        .circuit-title {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 16px;
        }

        /* DIODE 1N4007 */
        .diode {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .diode::before {
            content: '';
            position: absolute;
            left: -8px;
            width: 8px;
            height: 4px;
            background: #ff0000;
            border-radius: 50%;
        }

        .diode::after {
            content: '';
            position: absolute;
            right: -8px;
            width: 8px;
            height: 4px;
            background: #ff0000;
            border-radius: 50%;
        }

        /* LED INDICATORS */
        .led-container {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 100px;
        }

        .led-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .led {
            width: 30px;
            height: 50px;
            border-radius: 15px 15px 5px 5px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .led-charging{
            background-color: red;
        }
        .led-full{
            
            background-color: green;
        }
        .led-charging {
            background: linear-gradient(to bottom, #ff6b6b, #ff4757);
            animation: chargingPulse 1.5s infinite;
        }

        .led-full {
            background: linear-gradient(to bottom, #2ed573, #1dd1a1);
        }

        .led.off {
            background: rgb(246, 133, 133);
            animation: none;
            margin-left: 17px;
        }
         .led.on {
            margin-left: 20px;
            background: rgb(128, 242, 128);
            animation: none;
        }

        .led::before {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
       
            border-radius: 50%;
        }

        .led::after {
            content: '';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;

            border-radius: 50%;
        }

        .led-label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        @keyframes chargingPulse {
            0%, 100% { 
                opacity: 0.6;
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }
            50% { 
                opacity: 1;
                transform: scale(1.1);
                box-shadow: 0 0 25px rgba(255, 107, 107, 0.8);
            }
        }

        /* RESISTOR */
        .resistor {
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 15px;
            background: linear-gradient(90deg, 
                #8b4513 0%, #f4a460 20%, 
                #ff0000 30%, #ff0000 35%,
                #000000 40%, #000000 45%,
                #8b4513 55%, #f4a460 100%);
            border-radius: 7px;
            position: relative;
        }

        .resistor::before {
            content: '1kŒ©';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }

        .resistor::after {
            content: '';
            position: absolute;
            left: -10px;
            right: -10px;
            top: 6px;
            height: 3px;
            background: #333;
        }

        /* BATTERY */
        .battery-container {
            position: absolute;
            bottom: 50px;
            right: 80px;
        }

        .battery {
            width: 100px;
            height: 50px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .battery::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 20px;
            background: #2c3e50;
            border-radius: 0 3px 3px 0;
        }

        .battery-level {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            border-radius: 3px;
            transition: all 0.5s ease;
            width: 8%;
        }

        .battery-text {
            position: relative;
            z-index: 2;
            font-size: 10px;
        }

        .battery-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
            text-align: center;
            white-space: nowrap;
        }

        /* USB CABLE */
        .usb-container {
            position: absolute;
            bottom: 50px;
            left: 80px;
        }

        .usb-cable {
            width: 80px;
            height: 30px;
            background: #333;
            border-radius: 5px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .usb-cable::before {
            content: '';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 4px;
            background: #333;
            border-radius: 2px;
        }

        .usb-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        /* WIRES */
        .wire {
            position: absolute;
            background: #333;
            border-radius: 2px;
        }

        .wire-red { background: #ff0000; }
        .wire-black { background: #000; }

        /* CONTROL BUTTONS */
        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 100;
        }

        .control-button {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 120px;
        }

        .btn-power {
            background: linear-gradient(45deg, #4169e1, #8a2be2);
            color: white;
        }

        .btn-test {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
        }

        .control-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .control-button:active {
            transform: translateY(-1px);
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1024px) {
            .left-panel {
                position: relative;
                left: auto;
                top: auto;
                width: 100%;
                margin-bottom: 20px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .main-container {
                flex-direction: column;
            }
            
            .control-panel {
                position: relative;
                margin-top: 30px;
                transform: none;
                left: auto;
            }
        }

        @media (max-width: 768px) {
            .circuit-board {
                height: 400px;
            }
            
            .led-container {
                gap: 60px;
            }
            
            .control-button {
                padding: 10px 15px;
                font-size: 12px;
                min-width: 100px;
            }
        }

        @media (max-width: 480px) {
            .control-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .control-button {
                width: 100%;
                max-width: 250px;
            }
            
            .circuit-board {
                height: 350px;
            }
            
            .led-container {
                gap: 40px;
            }
        }
        .wire{
            position: absolute;
            z-index: 10;
        }
        .wire-red{
            background: red;
            top: 70px;
            right: 160px;
            width: 3px;
            height: 140px;
        }
        .wire-red2{
            background: red;
            top: 70px;
            left: 160px;
            width: 3px;
            height: 140px;
        }
        .wire-red3{
            background: red;
            top: 70px;
            right: 160px;
            width: 90px;
            height: 3px;
        }
        .wire-red4{
            background: red;
            top: 70px;
            left: 160px;
            width: 90px;
            height: 3px;
        }
          .wire-red5{
            background: red;
            top: 210px;
            right: 160px;
            width: 48px;
            height: 3px;
        }
        .wire-red6{
            background: red;
            top: 210px;
            left: 160px;
            width: 65px;
            height: 3px;
        }
        .wire-red7{
            background: red;
            top: 180px;
            right: 137px;
            width: 3px;
            height: 180px;
            transform: rotate(-50deg);
        }
        .wire-red8{
            background: red;
            top: 184px;
            left: 160px;
            width: 3px;
            height: 179px;
             transform: rotate(45deg);
        }
        .wire-red9{
            background: red;
            top: 325px;
            right: 69.5px;
            width: 3px;
            height: 95px;
        }
        .wire-red10{
            background: red;
           bottom: 70px;
            right: 70px;
            width: 7px;
            height: 3px;
        }
        .wire-red11{
            background: red;
            top: 170px;
            right: 205px;
            width: 3px;
            height: 45px;
        }
        .wire-red12{
            background: red;
           top: 170px;
            left: 220px;
            width: 3px;
            height: 42px;
        }
        .wire-black{
            background: black;
           bottom: 70px;
            right: 180px;
            width: 115px;
            height: 3px;
        }
         .wire-black1{
            background: black;
           bottom: 70px;
            right: 294.5px;
            width: 3px;
            height: 110px;
        }
         .wire-black2{
            background: black;
           bottom: 150px;
            left: 100px;
            width: 195px;
            height: 3px;
        }
         .wire-black3{
            background: black;
           bottom: 250px;
            right: 294.5px;
            width: 4px;
            height: 40px;
        }
          .wire-black4{
            background: black;
           bottom: 287px;
            right: 294.5px;
            width: 57px;
            height: 3px;
        }
          .wire-black5{
            background: black;
           bottom: 287px;
            right: 220px;
            width: 80px;
            height: 3px;
        }
            .wire-black6{
            background: black;
           bottom: 287px;
            right: 220px;
            width: 3px;
            height: 37px;
        }
          .wire-black7{
            background: black;
           bottom: 287px;
            left: 237px;
            width: 3px;
            height: 37px;
        }
        /* MODAL umumiy style */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    backdrop-filter: blur(3px);
}

/* MODAL ichki qismi */
.modal-content {
    background: #000075;
    color: white;
    margin: 5% auto;
    padding: 20px;
    width: 50%;
    max-width: 700px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    animation: slideDown 0.4s ease;
    position: relative;
}

/* Close tugmasi */
.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    color: white;
    transition: color 0.3s;
}
.close:hover {
    color: #ffcc00;
}

/* Sarlavha */
.modal-content h2 {
    font-size: 1.5em;
    margin-bottom: 15px;
    border-bottom: 2px solid rgba(255,255,255,0.2);
    padding-bottom: 8px;
}

    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo">
               <a href="/"><img src="/static/image/logo.png" width="80px" height="80px" alt=""></a>
            <span>Oddiy zaryadlash ko'rsatkichi</span>
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
        <!-- LEFT PANEL -->
        <div class="left-panel">
            <div class="control-group">
                <h3>Boshqaruv</h3>
                <button class="btn btn-success" onclick="startCharging()" id="startBtn">
                    ‚ö° Quvvatlash boshlash
                </button>
                <button class="btn btn-danger" onclick="stopCharging()" id="stopBtn">
                    ‚èπ Quvvatlashni to'xtatish
                </button>
                <button class="btn btn-primary" onclick="togglePower()">
                    üîå Quvvat
                </button>
                <button class="btn btn-info" onclick="runTest()">
                    üîç Test
                </button>
            </div>

            <div class="control-group">
                <h3>Ma'lumotlar</h3>
                <button class="btn btn-primary" onclick="showInfo('components')">
                    üîå Qurilmalar
                </button>
                <button class="btn btn-primary" onclick="showInfo('working')">
                    ‚öôÔ∏è Ishlash prinsipi
                </button>
                <button class="btn btn-primary" onclick="showInfo('usage')">
                    üí° Foydalanish
                </button>
            </div>

            <div class="control-group">
                <h3>Qurilma holati</h3>
                <div class="status-row">
                    <span>Quvvat:</span>
                    <div class="status-led" id="powerLed"></div>
                </div>
                <div class="status-row">
                    <span>Diode:</span>
                    <div class="status-led" id="diodeLed"></div>
                </div>
                <div class="status-row">
                    <span>Quvvatlash LED:</span>
                    <div class="status-led" id="chargingLed"></div>
                </div>
                <div class="status-row">
                    <span>To'liq LED:</span>
                    <div class="status-led" id="fullLed"></div>
                </div>
                <div class="status-row">
                    <span>Batareya:</span>
                    <div class="status-led" id="batteryLed"></div>
                </div>
                <div class="status-row">
                    <span>Batareya darajasi:</span>
                    <span id="batteryPercent">8%</span>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
       
            <div class="circuit-container">
                <div class="circuit-board">
                    <div class="circuit-title">Zaryadlash indikatori davri</div>
                    
                    <!-- 1N4007 Diode -->
                    <div >
                        <img src="/static/image/1n-removebg-preview.png"  width="100px" height="148px" alt="">
                    </div>
                    
                    <!-- LED Indicators -->
                    <div class="led-container">
                        <div class="led-group">
                                                
                            <div class="led led-charging off" id="chargingLedMain"></div>
                              <div class="led-label"> </div>
                        </div>
                        <div class="led-group">
                       
                            <div class="led led-full on"  id="fullLedMain"></div>
                                 <div class="led-label"> </div>
                            
                        </div>
                    </div>
                    
                    <!-- Resistor -->
                    <div style="margin-top: 80px;" >
                        <img src="/static/image/resistor_2.png" class="" id="resistor" width="100px" height="100px" alt="">
                    </div>
                    
                    <!-- USB Cable -->
                    <div class="usb-container">
                        <div >
                            <img src="/static/image/tpp - Copy.png" width="50px" height="100px"  alt="">
                        </div>
                        <div class="usb-label">USB Cable</div>
                    </div>
                      <div class="wire wire-red"></div>
                      <div class="wire wire-red2"></div>
                      <div class="wire wire-red3"></div>
                      <div class="wire wire-red4"></div>
                      <div class="wire wire-red5"></div>
                      <div class="wire wire-red6"></div>
                      <div class="wire wire-red7"></div>
                      <div class="wire wire-red8"></div>
                      <div class="wire wire-red9"></div>
                      <div class="wire wire-red10"></div>
                      <div class="wire wire-red11"></div>
                      <div class="wire wire-red12"></div>
                    <div class="wire wire-black"></div>
                     <div class="wire wire-black1"></div>
                      <div class="wire wire-black2"></div>
                       <div class="wire wire-black3"></div>
                      <div class="wire wire-black4"></div>
                       <div class="wire wire-black5"></div>
                      <div class="wire wire-black6"></div>
                      <div class="wire wire-black7"></div>
                    <!-- Battery -->
                    <div class="battery-container">
                        <div class="battery" id="battery">
                            <div class="battery-level" id="batteryLevel"></div>
                            <div class="battery-text" id="batteryText">8%</div>
                        </div>
                        <div class="battery-label">3.7V Lithium-Ion<br>Rechargeable</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTROL PANEL -->
    <div class="control-panel">
        <button class="control-button btn-power" onclick="togglePower()">
            ‚ö° Quvvat Yoqish/O'chirish
        </button>
        <button class="control-button btn-test" onclick="runTest()">
            üîç Tizimni sinash
        </button>
        <button class="control-button btn-reset" onclick="resetAll()">
            üîÑ Qayta o'rnatish
        </button>
    </div>
     <div class="modal" id="schemaModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Sxema qayerda ishlatiladi</h2>

        <div class="card">
            <video controls>
                <source src="videos/kitchen.mp4" type="video/mp4">
            </video>
            <p>Oshxona va qo'l yuvish joylarida gigiyena uchun ishlatiladi.</p>
        </div>

        <div class="card">
               <video controls>
                <source src="videos/kitchen.mp4" type="video/mp4">
            </video>
            <p>Avtomatlashtirilgan sug‚Äòorish tizimlarida suv oqimini boshqarish uchun.</p>
        </div>
    </div>
</div>


<div class="modal" id="codeModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Kod</h2>

        <!-- Tab tugmalar -->
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="mblock">mBlock Kodi</button>
            <button class="tab-btn" data-tab="arduino">Arduino Kodi</button>
        </div>

        <!-- mBlock kodi -->
        <div class="tab-content active" id="mblock">
            <pre>
// mBlock blok kodi bu yerda bo‚Äòladi (grafik kod tavsifi)
say "Qo'l aniqlansa relay yoqiladi"
            </pre>
        </div>

        <!-- Arduino kodi -->
        <div class="tab-content" id="arduino">
            <pre>
// TCRT5000 Sensor va Relay boshqaruvi
const int sensorPin = 2;
const int relayPin = 3;

void setup() {
  pinMode(sensorPin, INPUT);
  pinMode(relayPin, OUTPUT);
  Serial.begin(9600);
}

void loop() {
  int sensorValue = digitalRead(sensorPin);
  
  if (sensorValue == LOW) {
    digitalWrite(relayPin, HIGH);
    Serial.println("Qo'l aniqlangan - Suv oqimi yoqildi");
  } else {
    digitalWrite(relayPin, LOW);
    Serial.println("Qo'l yo'q - Suv oqimi o'chirildi");
  }
  
  delay(100);
}
            </pre>
        </div>
    </div>
</div>
<div class="modal" id="componentsModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Ishlatilgan qurilmalar</h2>

        <div class="card">
            <img src="images/tcrt5000.png" alt="TCRT5000 Sensor">
            <div class="text">
                <h3>TCRT5000 Infraqizil Sensor</h3>
                <p>Qo‚Äòl mavjudligini aniqlash uchun infraqizil texnologiya asosida ishlaydi.</p>
            </div>
        </div>

        <div class="card">
            <img src="images/lm393p.png" alt="LM393P Komparator">
            <div class="text">
                <h3>LM393P Komparator</h3>
                <p>Sensor signalini qayta ishlash va solishtirish uchun ishlatiladi.</p>
            </div>
        </div>

        <div class="card">
            <img src="images/relay.png" alt="5V Relay">
            <div class="text">
                <h3>5V Relay</h3>
                <p>Solenoid valve‚Äôni elektr signal orqali boshqaradi.</p>
            </div>
        </div>

        <!-- qolgan qurilmalar ham shu tarzda -->
    </div>
</div>

    <script>
         // Modal ochish / yopish
function openModal(id) {
    document.getElementById(id).style.display = "block";
}
function closeModal(id) {
    document.getElementById(id).style.display = "none";
}

document.querySelectorAll(".modal .close").forEach(btn => {
    btn.addEventListener("click", function() {
        this.closest(".modal").style.display = "none";
    });
});

window.addEventListener("click", function(e) {
    document.querySelectorAll(".modal").forEach(modal => {
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });
});

// Tab boshqaruvi
document.querySelectorAll(".tab-btn").forEach(button => {
    button.addEventListener("click", function() {
        const tab = this.dataset.tab;

        // Tugmalarni yangilash
        document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
        this.classList.add("active");

        // Kontentni yangilash
        document.querySelectorAll(".tab-content").forEach(content => {
            content.classList.remove("active");
            if (content.id === tab) {
                content.classList.add("active");
            }
        });
    });
});

        // System State Variables
        let powerOn = false;
        let isCharging = false;
        let batteryLevel = 8; // Starting at 8%
        let isFullyCharged = false;
        let chargingInterval = null;
        
        // DOM Elements
        const elements = {
            powerLed: document.getElementById('powerLed'),
            diodeLed: document.getElementById('diodeLed'),
            chargingLed: document.getElementById('chargingLed'),
            fullLed: document.getElementById('fullLed'),
            batteryLed: document.getElementById('batteryLed'),
            chargingLedMain: document.getElementById('chargingLedMain'),
            fullLedMain: document.getElementById('fullLedMain'),
            batteryLevelDiv: document.getElementById('batteryLevel'),
            batteryText: document.getElementById('batteryText'),
            batteryPercent: document.getElementById('batteryPercent')
        };

        // Update Battery Display
        function updateBatteryDisplay() {
            // Calculate width percentage (max 90% of battery width)
            const widthPercent = Math.min(batteryLevel, 100) * 0.9;
            elements.batteryLevelDiv.style.width = widthPercent + '%';
            
            // Update text displays
            elements.batteryText.textContent = Math.round(batteryLevel) + '%';
            elements.batteryPercent.textContent = Math.round(batteryLevel) + '%';
            
            // Update battery color based on level
            if (batteryLevel < 20) {
                elements.batteryLevelDiv.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            } else if (batteryLevel < 50) {
                elements.batteryLevelDiv.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
            } else if (batteryLevel < 80) {
                elements.batteryLevelDiv.style.background = 'linear-gradient(90deg, #f39c12, #27ae60)';
            } else {
                elements.batteryLevelDiv.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';
            }
        }

        // Update Status LEDs
        function updateStatus() {
            elements.powerLed.classList.toggle('on', powerOn);
            elements.diodeLed.classList.toggle('on', powerOn && isCharging);
            elements.chargingLed.classList.toggle('on', powerOn && isCharging && !isFullyCharged);
            elements.fullLed.classList.toggle('on', powerOn && isFullyCharged);
            elements.batteryLed.classList.toggle('on', powerOn);
            
            // Update main LEDs
            if (powerOn && isCharging && !isFullyCharged) {
                elements.chargingLedMain.classList.remove('off');
                elements.chargingLedMain.classList.add('led-charging');
            } else {
                elements.chargingLedMain.classList.add('off');
                elements.chargingLedMain.classList.remove('led-charging');
            }
            
            if (powerOn && isFullyCharged) {
                elements.fullLedMain.classList.remove('off');
                elements.fullLedMain.classList.add('led-full');
            } else {
                elements.fullLedMain.classList.add('off');
                elements.fullLedMain.classList.remove('led-full');
            }
        }

        // Power Control
        function togglePower() {
            powerOn = !powerOn;
            
            if (!powerOn) {
                // Turn off power - stop charging
                isCharging = false;
                if (chargingInterval) {
                    clearInterval(chargingInterval);
                    chargingInterval = null;
                }
            }
            
            updateStatus();
            console.log('Power:', powerOn ? 'ON' : 'OFF');
        }

        // Charging Control
        function startCharging() {
            if (!powerOn) {
                alert('Avval quvvatni yoqing!');
                return;
            }
            
            if (isFullyCharged) {
                alert('Batareya allaqachon to\'liq quvvatlangan!');
                return;
            }
            
            if (isCharging) {
                alert('Batareya allaqachon quvvatlanmoqda!');
                return;
            }
            
            isCharging = true;
            updateStatus();
            console.log('Charging started. Current level:', batteryLevel + '%');
            
            // Start charging animation with slower speed
            chargingInterval = setInterval(() => {
                if (batteryLevel < 100) {
                    batteryLevel += 1; // Increase by 1% every interval
                    updateBatteryDisplay();
                    
                    console.log('Charging... Level:', Math.round(batteryLevel) + '%');
                    
                    // Check if fully charged
                    if (batteryLevel >= 100) {
                        batteryLevel = 100; // Ensure it doesn't exceed 100
                        isFullyCharged = true;
                        isCharging = false;
                        updateStatus();
                        updateBatteryDisplay();
                        
                        clearInterval(chargingInterval);
                        chargingInterval = null;
                        
                        console.log('Battery fully charged!');
                        alert('Batareya to\'liq quvvatlandi!');
                    }
                } else {
                    // Safety check
                    clearInterval(chargingInterval);
                    chargingInterval = null;
                }
            }, 1000); // 1000ms = 1 second per 1%
        }

        function stopCharging() {
            if (!isCharging) {
                alert('Quvvatlash jarayoni ishlamayapti!');
                return;
            }
            
            isCharging = false;
            if (chargingInterval) {
                clearInterval(chargingInterval);
                chargingInterval = null;
            }
            updateStatus();
            console.log('Charging stopped at:', Math.round(batteryLevel) + '%');
        }

        // Test Function
        function runTest() {
            if (!powerOn) {
                alert('Avval quvvatni yoqing!');
                return;
            }
            
            alert('Test boshlandi...');
            console.log('Running system test...');
            
            // Save current state
            const originalCharging = isCharging;
            const originalFull = isFullyCharged;
            
            // Test sequence
            setTimeout(() => {
                // Test charging LED
                elements.chargingLedMain.classList.remove('off');
                elements.chargingLedMain.classList.add('led-charging');
                console.log('Testing charging LED...');
                
                setTimeout(() => {
                    // Switch to full LED
                    elements.chargingLedMain.classList.add('off');
                    elements.chargingLedMain.classList.remove('led-charging');
                    elements.fullLedMain.classList.remove('off');
                    elements.fullLedMain.classList.add('led-full');
                    console.log('Testing full LED...');
                    
                    setTimeout(() => {
                        // Return to original state
                        elements.fullLedMain.classList.add('off');
                        elements.fullLedMain.classList.remove('led-full');
                        
                        isCharging = originalCharging;
                        isFullyCharged = originalFull;
                        updateStatus();
                        
                        console.log('Test completed successfully!');
                        alert('Test tugadi!');
                    }, 1000);
                }, 1000);
            }, 500);
        }

        // Reset Function
        function resetAll() {
            // Stop any ongoing charging
            if (chargingInterval) {
                clearInterval(chargingInterval);
                chargingInterval = null;
            }
            
            // Reset all states
            powerOn = false;
            isCharging = false;
            isFullyCharged = false;
            batteryLevel = 8; // Reset to 8%
            
            // Update displays
            updateBatteryDisplay();
            updateStatus();
            
            console.log('System reset completed. Battery level:', batteryLevel + '%');
        }

        // Info Functions
        function showInfo(type) {
            let message = '';
            
            switch(type) {
                case 'components':
                    message = `Ishlatilgan qurilmalar:
                    
‚Ä¢ 1N4007 Diode - Teskari oqimdan himoya
‚Ä¢ 1kŒ© Resistor - Oqim cheklash
‚Ä¢ LED (Qizil) - Quvvatlash ko'rsatkichi
‚Ä¢ LED (Yashil) - To'liq quvvat ko'rsatkichi
‚Ä¢ 3.7V Li-ion batareya - Qayta quvvatlanadigan batareya
‚Ä¢ USB kabel - Quvvat manbayi`;
                    break;
                    
                case 'working':
                    message = `Ishlash prinsipi:
                    
1. USB orqali quvvat berilganda diode ishga tushadi
2. Batareya quvvatlanayotganda qizil LED yonadi
3. Batareya to'liq quvvatlanganida yashil LED yonadi
4. Resistor LED oqimini cheklaydi
5. Diode teskari oqimdan himoya qiladi`;
                    break;
                    
                case 'usage':
                    message = `Foydalanish:
                    
‚Ä¢ Power Bank'larda
‚Ä¢ Telefon quvvatlagichlarda
‚Ä¢ Batareya quvvatlash tizimlarida
‚Ä¢ Elektron qurilmalarda quvvat ko'rsatkichi sifatida
‚Ä¢ DIY loyihalarda`;
                    break;
            }
            
            alert(message);
        }

        // Initialize system on page load
        function initializeSystem() {
            console.log('System initialized');
            console.log('Battery level:', batteryLevel + '%');
            updateBatteryDisplay();
            updateStatus();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });

        // Also initialize immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSystem);
        } else {
            initializeSystem();
        }
    </script>
</body>
</html>